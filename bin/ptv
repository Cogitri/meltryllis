#!/bin/sh
branch="$(git rev-parse --abbrev-ref HEAD)"

push_to() {
	ansi --cyan-intense "== PUSHING TO $1"
	git push "$1" >/dev/null 2>&1 ||
		ansi --red-intense "<= FAILED TO PUSH $1" &&
		ansi --green-intense "=> $1 PUSHED"
}

if [ "$branch" != "master" ]
then
	ansi --red-intense "<= NEEDS TO BE IN BRANCH MASTER"
	exit 1
fi

ansi --yellow-intense "== COMMITS TO BE PUSHED"
gcp

if [ -f "${XDG_RUNTIME_DIR}/push-to-void" ]
then
	ansi --yellow-intense "== BRANCHES TO BE CLEARED"
	cat "${XDG_RUNTIME_DIR}/push-to-void"
else
	ansi --yellow-intense "== NO BRANCHES TO BE CLEANED"
fi

push_to origin
push_to upstream

if [ -f "${XDG_RUNTIME_DIR}/push-to-void" ]
then
	while read -r branch
	do
		git-clean-branches "$branch" >/dev/null 2>&1 ||
			ansi --red-intense "<= FAILED TO CLEAN BRANCH $branch" &&
			ansi --green-intense "=> CLEANED BRANCH $branch"
	done < "${XDG_RUNTIME_DIR}/push-to-void"
	rm -f "${XDG_RUNTIME_DIR}/push-to-void"
fi
