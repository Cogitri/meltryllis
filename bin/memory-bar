#!/bin/sh
_bargeo="140x30+750+0"

wait_mem() {
	_t="$(awk '/MemTotal/ {print $2}' /proc/meminfo)"
	_f="$(awk '/MemFree/ {print $2}' /proc/meminfo)"
	_b="$(awk '/^Buffers/ {print $2}' /proc/meminfo)"
	_c="$(awk '/^Cached/ {print $2}' /proc/meminfo)"
	mem="$(echo "100 * ($_t - $_f - $_c - $_b) / $_t" | bc)"
	if [ $mem -gt 90 ]; then
		notify-send.sh --replace=13513 "High memory usage!" -a "$mem%"
	fi

	case "$mem" in
		[0-9]|1[0-9]|2[0-9]|3[0-9]|40) echo "low ($mem%) memory usage" ;;
		4[1-9]|5[0-9]|6[0-9]|70) echo "avg ($mem%) memory usage" ;;
		7[1-9]|8[0-9]|9[0-9]|100) echo "high ($mem%) memory usage" ;;
	esac
}

while :; do
	echo "%{c}$(wait_mem)"
	sleep 60
done | lemonbar -f "${_barfont}" \
				-f "${_barfont2}" \
				-B "${_barbg}" \
				-F "${_barfg}" \
				-g "${_bargeo}" \
				-b -n "${_n}"
