#!/bin/sh
_bargeo="80x24+825+0"

wait_mem() {
	_t="$(awk '/MemTotal/ {print $2}' /proc/meminfo)"
	_f="$(awk '/MemFree/ {print $2}' /proc/meminfo)"
	_b="$(awk '/^Buffers/ {print $2}' /proc/meminfo)"
	_c="$(awk '/^Cached/ {print $2}' /proc/meminfo)"
	mem="$(echo "100 * ($_t - $_f - $_c - $_b) / $_t" | bc)"
	if [ $mem -gt 90 ]; then
		notify-send "High memory usage!" -a "$mem%"
	fi

	echo "$mem%"
}

while :; do
	echo "%{c} ${_t}MEM: ${_r}$(wait_mem) "
	sleep 60
done | lemonbar -f "${_barfont}" \
				-f "${_barfont2}" \
				-B "${_barbg}" \
				-F "${_barfg}" \
				-g "${_bargeo}" \
				-b -n "${_n}"
